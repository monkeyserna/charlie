<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Charlie drive</title>
    <style>
        html, body,iframe {
            height: 100%;
            width: 100%;
            margin: 0;
            border: 0;
            overflow:hidden;
        }
    </style>
    <script type="text/javascript" src="js/values.js"></script>
    <script type="text/javascript" src="phonegap.js"></script>
    <script type="text/javascript" charset="utf-8">
        
        function loadCamFrame(){
           document.getElementById('camframe').src =  "http://"+SERVER_IP+":"+SERVER_CAM_PORT+"/";
        }

        var watchID = null;
        var websocket = null;

        document.addEventListener("deviceready", onDeviceReady, false);

        function onDeviceReady() {
            document.getElementById('accelerometer').innerHTML = "Waiting for accelerometer";
            connectWS();
        }

        function connectWS(){
            websocket = new WebSocket(WEBHOST);

            websocket.onopen = function(evt) {
                startWatch()
            };

            websocket.onerror = function(evt) {
                websocket.close();
                connectWS();
            };
        }

        function startWatch() {
            var options = { frequency: ACCELEROMETER_FREQUENCY };
            watchID = navigator.accelerometer.watchAcceleration(onAccelerometerChanged, onAccelerometerError, options);
        }

        function onAccelerometerChanged(acceleration) {
            var element = document.getElementById('accelerometer');
            element.innerHTML = 'X: '  + acceleration.x + '<br />' +
                    'Y: '  + acceleration.y + '<br />' +
                    'Z: '  + acceleration.z + '<br />' +
                    'Timestamp: '      + acceleration.timestamp + '<br />';
            websocket.send(acceleration.x+";"+acceleration.y+";"+acceleration.z+";"+acceleration.timestamp)
        }

        function stopWatch() {
            if (watchID) {
                navigator.accelerometer.clearWatch(watchID);
                watchID = null;
            }
        }

        function disconnectWS(){
            websocket.close();
        }




        function onAccelerometerError() {
            alert('onError!');
        }



    </script>
</head>
<body>
<div id="accelerometer">Preparing...</div>
<iframe id="camframe" onload="loadCamFrame();"></iframe>
</body>
</html>
